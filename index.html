<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ALL OF US</title>

    <!-- Google Fonts: Roboto -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"/>
    <!-- Tailwind CSS CDN (for demo; use npm in production) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      :root{
        --brand-yellow:#EDFF00;
        --brand-orange:#FF5600;
        --ink:#1e1e1e;
        --paper:#FFFBEA;
      }
      body { font-family: 'Roboto', sans-serif; }
      .glass { backdrop-filter: blur(12px); background: rgba(30,30,30,0.45); }
      .dot{
        width:16px;height:16px;background:#EDFF00;border-radius:9999px;
        box-shadow:0 0 0 1px rgba(237,255,0,.9),0 0 10px rgba(237,255,0,.35);
      }
      @media (max-width:640px){ .dot{ width:12px;height:12px; box-shadow:0 0 0 1px rgba(237,255,0,.9),0 0 6px rgba(237,255,0,.3);} }
      .site-outline {
        position:absolute; top:60%; left:14%; width:12vw; min-width:90px;
        opacity:.78; transition:opacity .25s ease, transform .25s ease, filter .25s ease;
        filter: drop-shadow(0 0 0 rgba(237,255,0,0));
      }
      .site-outline:hover { opacity:1; transform: translateY(-1px); filter: drop-shadow(0 10px 14px rgba(237,255,0,.28)); }
      .map-soften{ filter: saturate(.98) contrast(.98) brightness(.98); }

      @keyframes drawLine { from { transform: scaleX(0); } to { transform: scaleX(1); } }
      .draw-line { transform-origin: left center; animation: drawLine 1100ms cubic-bezier(.22,.61,.36,1) forwards; }

      /* Panel 3 */
      #afterWrapper { clip-path: inset(0 50% 0 0); transition: clip-path 0.15s ease-out; }
      #divider span { transition: box-shadow .2s ease, transform .2s ease; }
      #divider:hover span { box-shadow: 0 0 12px rgba(237,255,0,.5); transform: scale(1.05); }
      #site1Scroller > section {scroll-snap-align: start; scroll-snap-stop:always;}
      #baWrap, #afterWrapper, #divider { touch-action: pan-y; }

      /*Panel 5*/

      /* Panel 5 dots: NO looping animation */
      .dot-pin {
        position: absolute;
        width: 2px;                 /* start small */
        height: 2px;
        border-radius: 9999px;
        background: rgba(237,255,0,.25);
        box-shadow: 0 0 0 1px rgba(237,255,0,.9), 0 0 14px rgba(237,255,0,.35);
        transform: translate(-50%, -50%);
        transform-origin: center;
        animation: none !important;   /* kill any leftover .pulse */
      }


      /* breathing grow/shrink */
      @keyframes dotPulse{
        0%,100%{ transform:translate(-50%,-50%) scale(1); }
        50%     { transform:translate(-50%,-50%) scale(1.9); }
      }

      /* force animation even if other rules exist */
      .pulse{
        animation:dotPulse 1.6s ease-in-out infinite !important;
      }

      /* optional soft glow ring */
      .dot-pin::after{
        content:"";
        position:absolute; inset:-10px;
        border-radius:9999px;
        background:rgba(237,255,0,.16);
        filter:blur(6px);
        pointer-events:none;
      }

      .panel5-overlay {
        position: absolute;
        top: 20px;  /* adjust to where you want it */
        left: 20px;
        background-color: rgba(0, 0, 0, 0.6); /* translucent background */
        color: white;
        padding: 12px 16px;
        border-radius: 6px;
        max-width: 300px;
        z-index: 999; /* ensure it’s above dots */
      }

      .panel5-title {
        font-size: 1.4rem;
        margin: 0 0 4px;
      }

      .panel5-legend {
        font-size: 0.9rem;
        margin: 0;
        opacity: 0.85;
      }


    </style>
  </head>
  <body class="relative min-h-screen bg-black overflow-x-hidden">

    <!-- MAP BACKGROUND -->
    <div class="absolute inset-0 z-0">
      <img src="assets/250722_map3.png" alt="LA Map"
           class="map-soften w-full h-full object-cover object-center fixed inset-0 pointer-events-none select-none" />
    </div>

    <!-- HERO BLUR OVERLAY + STATEMENTS -->
    <div id="heroBlur"
      class="absolute inset-0 flex flex-col items-center justify-center z-10 transition-all duration-1000 glass"
      style="min-height:100vh;">
      <h1 id="heroMain" class="px-6 text-[6vw] sm:text-4xl md:text-6xl font-bold text-[color:var(--brand-yellow)] leading-tight text-center opacity-0 transition-opacity duration-700">
        We believe in sharing the city
      </h1>
      <p id="heroSub" class="px-6 mt-4 sm:mt-6 text-[2.6vw] sm:text-lg md:text-2xl text-[color:var(--brand-yellow)] leading-snug text-center font-normal opacity-0 transition-opacity duration-700">
        Designing cities that include All Of Us
      </p>
    </div>

    <!-- MAIN INTERFACE -->
    <div id="mainUI"
      class="absolute inset-0 w-full h-full z-20 flex flex-col justify-between opacity-0 pointer-events-none transition-opacity duration-700">

      <!-- HEADER -->
      <div class="flex flex-row justify-between items-start w-full px-5 pt-4">
        <div>
          <span class="block text-[8vw] font-normal leading-[1] text-[#EDFF00] select-none">ALL OF US</span>
        </div>
        <div class="flex flex-col items-end gap-3">
          <span class="bg-[#FFFBEA] px-4 py-1 rounded text-[#FF5600] text-xs sm:text-base font-bold tracking-wide shadow">
            <strong>CURIOUS?</strong> WE THOUGHT SO, LET'S TALK
          </span>
          <button id="backBtn" class="hidden mt-2 bg-[#FF5600] text-[#FFFBEA] rounded px-4 py-1 font-medium text-sm">← BACK TO MAP</button>
        </div>
      </div>

      <!-- Dots -->
      <div class="pointer-events-none z-30">
        <div class="dot absolute" style="top:20vh; left:1vw;"></div>
        <div class="dot absolute" style="top:35vh; left:1vw;"></div>
        <div class="dot absolute" style="top:50vh; left:1vw;"></div>
        <div class="dot absolute" style="top:65vh; left:1vw;"></div>
        <div class="dot absolute" style="top:80vh; left:1vw;"></div>
        <div class="dot absolute" style="top:95vh; left:1vw;"></div>
        <div class="dot absolute" style="top:95vh; left:10vw;"></div>
        <div class="dot absolute" style="top:95vh; left:20vw;"></div>
        <div class="dot absolute" style="top:95vh; left:30vw;"></div>
        <div class="dot absolute" style="top:95vh; left:40vw;"></div>
        <div class="dot absolute" style="top:95vh; left:50vw;"></div>
        <div class="dot absolute" style="top:95vh; left:60vw;"></div>
        <div class="dot absolute" style="top:95vh; left:70vw;"></div>
        <div class="dot absolute" style="top:95vh; left:80vw;"></div>
        <div class="dot absolute" style="top:95vh; left:90vw;"></div>
      </div>

      <!-- SITE OUTLINE OVER MAP -->
      <img src="assets/250805-Site01.png" alt="Site 1 outline" id="site1img"
           class="site-outline z-30 cursor-pointer" title="Go to Site 1" />

      <!-- LEARN MORE BUTTON -->
      <div class="absolute top-[32%] right-8 z-30">
        <button id="learnMoreBtn"
          class="bg-[#FFFBEA] text-[#0087FF] px-6 py-3 rounded-lg font-bold text-base flex items-center gap-2 shadow transition
                 opacity-100 hover:bg-white active:scale-95">
          LEARN MORE <span class="ml-1 text-2xl animate-bounce">➝</span>
        </button>
      </div>

      <!-- EXPLORE SITES PHRASE -->
      <div class="absolute bottom-[10%] left-1/2 -translate-x-1/2 z-40">
        <p class="bg-[#FF5600] text-[#EDFF00] px-6 py-3 rounded text-lg font-bold shadow-lg select-none">
          Explore the sites for discovering our proposals
        </p>
      </div>
    </div>

    <!-- ABOUT -->
    <div id="aboutSection"
      class="fixed inset-0 bg-[#FFFBEA] text-[#32332B] z-50 flex flex-col items-center justify-center px-6 py-20 opacity-0 pointer-events-none transition-all duration-500">
      <div class="bg-white/80 border border-black/5 rounded-2xl shadow px-8 py-10 max-w-2xl w-full text-center">
        <h2 class="text-3xl md:text-4xl font-bold mb-4">What is All of Us?</h2>
        <p class="text-base md:text-lg leading-relaxed">
          Background, purpose, values…
        </p>
      </div>
    </div>

    <!-- SITE 1 PANEL -->
    <section id="site1Panel"
      class="fixed inset-0 z-[60] bg-[#FFFBEA] text-[#32332B] translate-x-full opacity-0 pointer-events-none
             transition-all duration-700 ease-out overflow-hidden">

      <!-- SCROLLER -->
      <div id="site1Scroller" class="h-screen overflow-y-auto snap-y snap-mandatory snap-always overscroll-contain scroll-smooth">

        <!-- BACK TO MAP -->
        <div class="absolute top-6 right-6 z-30">
          <button id="site1Back"
            class="bg-[#FF5600] text-white px-4 py-2 rounded text-sm font-medium hover:bg-[#e94e00] transition-colors">
            ← BACK TO MAP
          </button>
        </div>

        <!-- PANEL 1 -->
        <section id="panel1" class="w-screen h-screen snap-start flex bg-[#FFFBEA] relative">
          <div class="flex-1 flex flex-col justify-between p-6 lg:p-10">
            <div>
              <h1 class="text-[8vw] font-normal leading-[.95] text-[#EDFF00] select-none">ALL OF US</h1>
            </div>
            <div class="pb-4">
              <h2 class="text-[5vw] sm:text-3xl md:text-4xl lg:text-9xl font-bold text-[#32332B] leading-tight">Site 1</h2>
              <p class="text-[3.5vw] sm:text-lg md:text-xl lg:text-3xl text-[#32332B] leading-snug">220 Sunset Ave Parking</p>
            </div>
          </div>
          <div class="flex-1 flex items-center justify-center p-6 md:p-10">
            <div class="relative overflow-hidden w-[min(50vw,100vh)] h-[min(50vw,100vh)] max-w-full max-h-full">
              <img src="sites/assets/2500804-Bldg01-02_00001_.png" alt="Site 1 visualization"
                   class="absolute inset-0 w-full h-full object-cover"/>
            </div>
          </div>
        </section>

        <!-- PANEL 2 -->
        <section id="panel2" class="w-screen h-screen snap-start bg-[#FFFBEA] relative overflow-hidden">
          <img id="zoomImgP2" src="sites/assets/Site-Bldg01.png" alt="Zoom-in to Site 1"
               loading="lazy" class="absolute inset-0 w-full h-full object-cover transition-transform duration-[3000ms] ease-out will-change-transform"/>
          <div class="absolute left-6 top-1/2 -translate-y-1/2 z-10">
            <h3 class="text-[#EDFF00] text-4xl font-extrabold leading-tight">220 Sunset Ave</h3>
            <p class="text-[#EDFF00] text-2xl leading-tight">Venice, Los Angeles, CA.</p>
            <div class="mt-3 h-[8px] w-[60vw] md:w-[45vw] rounded-full overflow-hidden">
              <div id="addrLine" class="h-full w-full bg-[#EDFF00] scale-x-0"></div>
            </div>
          </div>
        </section>

        <!-- PANEL 3 — Before / After slider -->
        <section id="panel3" class="w-screen h-screen snap-start bg-[#FFFBEA] flex items-center justify-center p-6">
          <div id="baWrap"
               class="relative w-[min(92vw,1200px)] aspect-[16/9] rounded-none overflow-hidden shadow-xl select-none touch-pan-y">

            <!-- BEFORE -->
            <img src="sites/assets/2500804-Bldg01-02_00001_.png" alt="Before"
                 class="absolute inset-0 w-full h-full object-cover" />

            <!-- AFTER (clipped) -->
            <div id="afterWrapper" class="absolute inset-0 overflow-hidden touch-pan-y">
              <img src="sites/assets/2500804-Bldg01-02_00001_.png" alt="After"
                   class="absolute inset-0 w-full h-full object-cover" />
            </div>

            <!-- Divider + handle -->
            <div id="divider"
                 class="absolute inset-y-0 left-1/2 -translate-x-1/2 w-[3px] bg-[#EDFF00] cursor-col-resize z-20
                        flex items-center justify-center touch-pan-y">
              <span class="pointer-events-none w-10 h-10 rounded-full bg-[#EDFF00] text-black
                           flex items-center justify-center font-bold text-lg leading-none shadow">↔</span>
            </div>

            <!-- Labels -->
            <span id="labelBefore"
                  class="absolute top-4 left-4 text-[#EDFF00] text-[4vw] md:text-[3vw] lg:text-[2.2vw] font-extrabold uppercase
                         opacity-0 transition-opacity duration-200 pointer-events-none select-none">BEFORE</span>
            <span id="labelAfter"
                  class="absolute top-4 right-4 text-[#EDFF00] text-[4vw] md:text-[3vw] lg:text-[2.2vw] font-extrabold uppercase
                         opacity-0 transition-opacity duration-200 pointer-events-none select-none">AFTER</span>

            <input id="baRange" type="range" min="0" max="100" value="50" aria-label="Before/After slider" class="sr-only"/>
          </div>
        </section>

       <!-- PANEL 4 — Left-aligned, compressed summary + video -->
        <section id="panel4" class="w-screen h-screen snap-start bg-[#FFFBEA] relative">
          <div class="h-full grid grid-rows-2 lg:grid-rows-1 lg:grid-cols-2">

            <!-- Left: left-aligned, compact text -->
            <div class="flex items-center px-6 lg:px-16">
              <div class="text-[#FF5600] max-w-sm">
                <p class="uppercase tracking-[0.15em] text-xs font-bold opacity-80 mb-2">
                  Category: Ground Parking – Private Owned
                </p>

                <h2 class="text-2xl md:text-3xl font-extrabold mb-4">
                  Site 1 Summary
                </h2>

                <ul class="space-y-1 text-sm md:text-base font-medium leading-snug">
                  <li><span class="font-bold">112</span> housing units</li>
                  <li><span class="font-bold">51</span> studios &amp; <span class="font-bold">61</span> 1BR</li>
                  <li>Monthly rent: <span class="font-bold">$219,070</span></li>
                  <li>Site area: <span class="font-bold">2,379.29 m²</span></li>
                  <li>Usage area (Parking Lots): <span class="font-bold">1,570.32 m²</span></li>
                  <li><span class="font-bold">125</span> parking spots</li>
                  <li>Parking income: <span class="font-bold">$22,612.73</span></li>
                  <li>Maintenance (avergafe): <span class="font-bold">$550</span></li>
                  <li>Net income: <span class="font-bold">$22,062.73</span></li>
                </ul>

                <p class="text-xs opacity-70 mt-3">Values obtained by the simulator</p>
              </div>
            </div>

            <!-- Right: video -->
            <div class="relative">
              <video
                id="p4Video"
                class="absolute inset-0 w-full h-full object-cover"
                playsinline
                muted
                loop
                preload="metadata"
                poster="sites/Site1/250708-Bldg01-04_Flux_1024_.png">
                <source src="sites/Site1/Bldg01-03.webm" type="video/webm">
                <source src="sites/Site1/Bldg01-03.mp4" type="video/mp4">
              </video>
            </div>

          </div>
        </section>


        <!-- PANEL 5 — Map with animated dots -->
        <section id="panel5" class="w-screen h-screen snap-start relative overflow-hidden bg-black">
          <!-- Map Image -->
          <img
            src="sites/Site1/Site-WaymoDots.png" 
            alt="Context map around the site"
            class="absolute inset-0 w-full h-full object-cover select-none pointer-events-none"
            loading="lazy" decoding="async"
          />

          <div class="panel5-overlay">
            <h2 class="panel5-title">Waymo Starting Trip Points</h2>
            <p class="panel5-legend">Each point represents approximately 3,200 weekly trips started</p>
          </div>


          <!-- Dots (position via top/left). Add pulse + optional staggered delay -->
          <button class="dot-pin" style="top: 81%; left: 33%;"></button>
          <button class="dot-pin" style="top: 17%; left: 85%; animation-delay:.25s"></button>

          <!-- (Optional) label or legend -->
          <!-- <div class="absolute left-6 bottom-6 text-xs text-white/80">Green dots indicate candidate sites.</div> -->
        </section>


    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // CORE REFS
        const heroBlur  = document.getElementById('heroBlur');
        const heroMain  = document.getElementById('heroMain');
        const heroSub   = document.getElementById('heroSub');
        const mainUI    = document.getElementById('mainUI');
        const learnMore = document.getElementById('learnMoreBtn');
        const about     = document.getElementById('aboutSection');
        const backBtn   = document.getElementById('backBtn');
        const site1img  = document.getElementById('site1img');
        const site1Panel= document.getElementById('site1Panel');
        const site1Back = document.getElementById('site1Back');
        const scroller  = document.getElementById('site1Scroller');

        // HERO
        setTimeout(() => heroMain.classList.add('opacity-100'), 600);
        setTimeout(() => heroSub.classList.add('opacity-100'), 1400);
        setTimeout(() => {
          heroMain.classList.remove('opacity-100');
          heroSub.classList.remove('opacity-100');
          heroBlur.classList.add('opacity-0', 'pointer-events-none');
        }, 3200);
        setTimeout(() => {
          mainUI.classList.add('opacity-100');
          mainUI.classList.remove('pointer-events-none');
        }, 4000);

        // ABOUT
        function closeSite1() {
          if (!site1Panel) return;
          site1Panel.classList.add('translate-x-full', 'opacity-0');
          setTimeout(() => site1Panel.classList.add('pointer-events-none'), 700);
        }
        learnMore?.addEventListener('click', () => {
          closeSite1();
          about.classList.remove('pointer-events-none');
          about.classList.add('opacity-100');
          mainUI.classList.remove('opacity-100');
          mainUI.classList.add('pointer-events-none');
          setTimeout(() => backBtn?.classList.remove('hidden'), 400);
        });
        backBtn?.addEventListener('click', () => {
          about.classList.remove('opacity-100');
          about.classList.add('pointer-events-none');
          mainUI.classList.add('opacity-100');
          mainUI.classList.remove('pointer-events-none');
          backBtn.classList.add('hidden');
        });

        // OPEN SITE 1
        function openSite1() {
          const p1 = document.getElementById('panel1');
          about.classList.remove('opacity-100');
          about.classList.add('pointer-events-none');
          backBtn?.classList.remove('hidden');

          site1Panel.classList.remove('pointer-events-none');
          requestAnimationFrame(() => {
            site1Panel.classList.remove('translate-x-full', 'opacity-0');
            site1Panel.classList.add('opacity-100');

            if (scroller && p1) {
              scroller.classList.add('snap-none');
              scroller.scrollTo({ top: 0, left: 0, behavior: 'instant' });
              p1.scrollIntoView({ block: 'start', inline: 'nearest' });
              setTimeout(() => scroller.classList.remove('snap-none'), 50);
            }
          });
        }
        site1img?.addEventListener('click', openSite1);
        site1Back?.addEventListener('click', closeSite1);

        // PANEL 2: address line
        const line = document.getElementById('addrLine');
        const panel2 = document.getElementById('panel2');
        if (line && panel2) {
          const io = new IntersectionObserver((entries) => {
            const e = entries[0];
            if (e.isIntersecting && e.intersectionRatio >= 0.6) {
              line.classList.remove('scale-x-0');
              line.classList.add('draw-line');
            } else {
              line.classList.remove('draw-line');
              line.classList.add('scale-x-0');
            }
          }, { threshold: [0, 0.6, 1], root: scroller || null });
          io.observe(panel2);
        }

        // ===== PANEL 3: slider (dominance-guard + attach listeners only while dragging) =====
          const baWrap      = document.getElementById('baWrap');
          const afterWrap   = document.getElementById('afterWrapper');
          const divider     = document.getElementById('divider');
          const labelBefore = document.getElementById('labelBefore');
          const labelAfter  = document.getElementById('labelAfter');
          const baRange     = document.getElementById('baRange');

          function setSplit(percent){
            const pct = Math.max(0, Math.min(100, percent));
            divider.style.left = pct + '%';
            afterWrap.style.clipPath = `inset(0 ${100 - pct}% 0 0)`;
            if (pct < 45) { labelBefore.classList.add('opacity-100'); labelAfter.classList.remove('opacity-100'); }
            else if (pct > 55) { labelAfter.classList.add('opacity-100'); labelBefore.classList.remove('opacity-100'); }
            else { labelBefore.classList.remove('opacity-100'); labelAfter.classList.remove('opacity-100'); }
            if (baRange) baRange.value = pct;
          }
          function percentFromClientX(clientX){
            const rect = baWrap.getBoundingClientRect();
            const x = Math.max(rect.left, Math.min(clientX, rect.right));
            return ((x - rect.left) / rect.width) * 100;
          }

          // Only allow drag if Panel 3 is dominant in view (>= 0.9 ratio)
          let panel3Dominant = false;
          const panel3 = document.getElementById('panel3');
          const root   = document.getElementById('site1Scroller') || null;
          if (panel3) {
            const io3 = new IntersectionObserver((entries)=>{
              const e = entries[0];
              panel3Dominant = e.isIntersecting && e.intersectionRatio >= 0.9;
              // when we arrive to panel 3, re-center split
              if (panel3Dominant) setSplit(50);
            }, { threshold: [0.0, 0.5, 0.9, 1], root });
            io3.observe(panel3);
          }

          // gesture state
          let tracking = false, dragging = false;
          let startX = 0, startY = 0;
          const THRESH = 8;

          function onPointerDown(ev){
            // guard: only start tracking if panel 3 is clearly centered
            if (!panel3Dominant) return;
            tracking = true; dragging = false;
            startX = ev.clientX; startY = ev.clientY;

            // attach move/up only while we might drag
            window.addEventListener('pointermove', onPointerMove, { passive: false });
            window.addEventListener('pointerup', onPointerUp);
            window.addEventListener('pointercancel', onPointerUp);
          }

          function onPointerMove(ev){
            if (!tracking) return;
            const dx = ev.clientX - startX;
            const dy = ev.clientY - startY;

            // if user goes vertical first, abort tracking so scroll proceeds
            if (!dragging) {
              if (Math.abs(dy) > Math.abs(dx)) { cleanup(); return; }
              if (Math.abs(dx) > THRESH) {
                dragging = true;
                if (baWrap.setPointerCapture && ev.pointerId != null) baWrap.setPointerCapture(ev.pointerId);
              } else {
                return; // not enough horizontal intent yet
              }
            }

            // actively dragging horizontally
            ev.preventDefault(); // stop scroll only once confirmed
            setSplit(percentFromClientX(ev.clientX));
          }

          function onPointerUp(ev){
            cleanup();
          }

          function cleanup(){
            tracking = false; dragging = false;
            window.removeEventListener('pointermove', onPointerMove, { passive: false });
            window.removeEventListener('pointerup', onPointerUp);
            window.removeEventListener('pointercancel', onPointerUp);
          }

          if (baWrap && divider && afterWrap) {
            // start tracking ONLY on the handle
            divider.addEventListener('pointerdown', onPointerDown);

            // keyboard via hidden range
            baRange?.addEventListener('input', (e) => setSplit(+e.target.value));

            // init position
            setSplit(50);
          }

          // ===== PANEL 4: smart play/pause (unchanged) =====
          const p4 = document.getElementById('panel4');
          const p4Video = document.getElementById('p4Video');
          if (p4 && p4Video) {
            const io4 = new IntersectionObserver((entries) => {
              const e = entries[0];
              if (e.isIntersecting && e.intersectionRatio >= 0.6) {
                p4Video.play().catch(()=>{});
              } else {
                p4Video.pause();
              }
            }, { threshold: [0, 0.6, 1], root });
            io4.observe(p4);
          }

          // Panel 5 //
          // One-time grow for Panel 5 dots (2px -> 100px)
          (function () {
            const panel5 = document.getElementById('panel5');
            if (!panel5) return;

            const growDots = () => {
              const dots = panel5.querySelectorAll('.dot-pin');
              dots.forEach((dot, i) => {
                // tiny stagger optional
                setTimeout(() => {
                  dot.style.transition = 'width 1200ms ease-out, height 1200ms ease-out';
                  dot.style.width = '1000px';
                  dot.style.height = '1000px';
                }, i * 120); // adjust or set to 0 for no stagger
              });
            };

            // Run once when panel 5 is mostly in view
            const io = new IntersectionObserver((entries) => {
              const e = entries[0];
              if (e.isIntersecting && e.intersectionRatio >= 0.6) {
                growDots();
                io.disconnect(); // ensure it only runs once
              }
            }, { threshold: [0, 0.6, 1], root: document.getElementById('site1Scroller') || null });

            io.observe(panel5);
          })();

          function showPanel5Overlay() {
            const overlay = document.querySelector('.panel5-overlay');
            overlay.style.opacity = '0';
            overlay.style.transition = 'opacity 1s ease';
            setTimeout(() => overlay.style.opacity = '1', 200);
          }

          // Call this when Panel 5 becomes active
          showPanel5Overlay();

        
        });
        </script>
        
  </body>
</html>
